# 图片生成 API 对接文档

> 本文档描述智谱方与用户方的接口对接规范

---

## 一、智谱方接口

### 接口信息

| 项目 | 值 |
|------|-----|
| 方法 | POST |
| 地址 | `https://image.z.ai/api/proxy/images/generate` |

### Headers

```
Content-Type: application/json
Accept: text/event-stream
Origin: {{ZAI_IMAGE_BASE_URL}}
Referer: {{ZAI_IMAGE_BASE_URL}}/
User-Agent: Mozilla/5.0 AppleWebKit/537.36 Chrome/143 Safari/537
```

### Cookie

```
session: {{ZAI_TOKEN}}
```

> `{{ZAI_TOKEN}}` 为用户传入的 token

### Request Body

```json
{
    "prompt": "这是一幅旨在向中学生科普TNR概念的彩色涂鸦风格教学插图...",
    "ratio": "3:4",
    "resolution": "1K",
    "rm_label_watermark": true
}
```

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| prompt | string | ✅ | 图片生成提示词 |
| ratio | string | ✅ | 图片比例，见下方支持列表 |
| resolution | string | ✅ | 分辨率：`1K` 或 `2K` |
| rm_label_watermark | boolean | ❌ | 是否去除水印，默认 `true` |

**支持的 ratio：** `1:1`、`3:4`、`4:3`、`16:9`、`9:16`、`21:9`、`9:21`

### Response

```json
{
    "code": 200,
    "message": "Success",
    "data": {
        "image": {
            "image_id": "2015714679560605696",
            "prompt": "...",
            "size": "1088x1472",
            "ratio": "3:4",
            "resolution": "1K",
            "image_url": "https://z-ai-audio.oss-cn-hongkong.aliyuncs.com/...",
            "status": "1",
            "created_at": "2026-01-26T17:13:24.433776+08:00",
            "updated_at": "2026-01-26T17:14:04.830465+08:00",
            "width": 1088,
            "height": 1472
        }
    },
    "timestamp": 1769418844
}
```

---

## 二、用户方接口

> 基于 OpenAI-Chat 格式适配

### 接口信息

| 项目 | 值 |
|------|-----|
| 方法 | POST |
| 地址 | `/v1/chat/completions` |

### Headers

| 参数 | 值 | 说明 |
|------|-----|------|
| Authorization | Bearer `{{token}}` | 用户传入的认证令牌 |
| Content-Type | application/json | 请求体格式 |

### Request Body

```json
{
    "model": "gemini-3-image-1k",
    "messages": [
        {
            "role": "user",
            "content": "一只可爱的橘猫在阳光下打盹"
        }
        {
            "role": "system",
            "content": "你是一个图片生成助手"
        }
    ],
    "stream": true
}
```

> ⚠️ `system` 消息会被自动抛弃，仅保留单轮 `user` 消息

### 模型 ID 规范

**支持的分辨率：** `1K`、`2K`

**默认比例：** `21:9`

**命名格式：** `gemini-3-image-{分辨率}[-{比例}]`

| 用户传入 | resolution | ratio | 说明 |
|----------|------------|-------|------|
| `gemini-3-image-1k` | 1K | 21:9 | 默认比例 |
| `gemini-3-image-2k` | 2K | 21:9 | 默认比例 |
| `gemini-3-image-1k-1-1` | 1K | 1:1 | 指定比例 |
| `gemini-3-image-2k-16-9` | 2K | 16:9 | 指定比例 |

**支持的比例后缀：**

| 后缀 | ratio | 说明 |
|------|-------|------|
| `-1-1` | 1:1 | 正方形 |
| `-3-4` | 3:4 | 竖屏 |
| `-4-3` | 4:3 | 横屏 |
| `-16-9` | 16:9 | 标准宽屏 |
| `-9-16` | 9:16 | 竖屏宽屏 |
| `-21-9` | 21:9 | 超宽屏（默认） |
| `-9-21` | 9:21 | 竖屏超宽 |

### 功能限制

| 特性 | 状态 | 说明 |
|------|------|------|
| 文生图 | ✅ | 根据文本生成图片 |
| 图生图 | ❌ | 不支持 |
| 系统提示词 | ❌ | 自动抛弃 |
| 多轮对话 | ❌ | 仅支持单轮 |

### Response（流式 SSE）

```
data: {"candidates": [{"content": {"parts": [{"inlineData": {"mimeType": "image/jpeg", "data": "iVBORw0KGgoAAAANSUhEUgAA..."}}]}}]}
```

| 字段 | 说明 |
|------|------|
| mimeType | 图片 MIME 类型 |
| data | Base64 编码图片数据 |

